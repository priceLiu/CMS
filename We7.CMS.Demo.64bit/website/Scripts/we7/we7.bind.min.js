(function(){function d(a){var b=this;this.tableName=a&&a.tableName||"";this.fields=a&&a.fields||"";this.conditions=a&&a.conditions||[];this.sortField=a&&a.sortField||"";this.sortOrder=a&&a.sortOrder||1;this.toURI=function(){function a(a){var b=[];for(var c in a){if(a.hasOwnProperty(c)){b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]))}}return b.join("&")}return a(this.toParam())};this.toParam=function(){var a={},c=[],d=b.sortOrder;if(we7.isStr(d)){if(b.sortOrder.toLowerCase()==="desc"){d=1}else{d=0}}a["_tb"]=b.tableName;a["_f"]=we7.isStr(b.fields)?b.fields:function(){var a=[];$.each(b.fields,function(b,c){a.push(b)});return a.join(",")}();if(b.sortField){a["_sort"]=b.sortField;a["_sord"]=d}$.each(b.conditions,function(a,b){if(b){c.push(b.toParam())}});a["_c"]=c.join("|");return a};return this}function c(a,c,d){this.source=a;this.operator=c;this.target=d;this.toParam=function(){var a=this.operator,c=this.target;switch(a){case b.isNull:case b.notNull:c="";break;case b.beginWith:case b.notBeginWidth:if(a===b.beginWidth){a=b.contains}else{a=b.notContain}c="%"+c;break;case b.endWidth:case b.notEndWidth:if(a===b.endWidth){a=b.contains}else{a=b.notEndWidth}c+="%";break;default:break}return we7.formatStr("{0}@{1}@{2}",this.source,a,c)};return this}function a(a,d,e){function F(a){var b=$.extend({},v),c=[];if(!b.totalRecords){return}var d=0,f=e.colModel;if(a.length){a=a.toLowerCase();$.each(b.rows,function(b,e){d=0;var g;if(p){g=B.apply(e,[!0]);d=g?g.toLowerCase().indexOf(a):-1;if(d>-1){e._keyMatch=d;c.push(e)}}else{$.each(e,function(b,g){var h=we7.findInArray(f,function(a){return a.name===b});if(h&&h.hidden){return}d++;if(!we7.isUndef(g)&&g.toString().toLowerCase().indexOf(a)>-1){e._keyMatch=d;c.push(e);return!1}})}});c.sort(function(a,b){return a._keyMatch-b._keyMatch});$.each(c,function(a){delete c[a]._keyMatch});b.rows=c}s.jqGrid("clearGridData")[0].addJSONData(b)}function E(a){var b=$("#gbox_"+h);var c=v&&v.rows?we7.findInArray(v.rows,function(b){return b[e.jsonReader.id]===a}):undefined;var d=n("onBeforeDelete",[a,c]);if(d.isDefaultPrevented()){return!1}s.jqGrid("delGridRow",a,{reloadAfterSubmit:!0,jqModal:!1,serializeDelData:C,left:b.width()/2-120,top:Math.max(b.height()/2-80,20),ajaxDelOptions:{beforeSend:function(b,d){d.success=function(b,d){b=JSON.parse(b);if(b.code==200){n("onDelete",[b,a,c,this.data])}}}}})}function D(a,b){if(!o){return}e.addEditColumn&&jQuery.jgrid._operateEditUI(a,!0);b=b||{};var c=v&&v.rows?we7.findInArray(v.rows,function(b){return b[e.jsonReader.id]===a}):undefined;var d=b.onsuccess,f=n("onBeforeEdit",[a,c]);if(f.isDefaultPrevented()){return!1}b.onsuccess=function(){var b=[].slice.apply(arguments);if(d){d.apply(this,b)}n("onEdit",[a,c].push(b))};s.jqGrid("editRow",a,!1,b.onedit,b.onsuccess,b.url,b.data,b.onsave,b.onerror,b.onrestore)}function C(a){if(!o){return null}var d=[],f=[];for(var g in a){if(a.hasOwnProperty(g)){if(g.substr(0,1)!="_"){d.push(g);f.push((new c(g,b.equals,a[g])).toParam())}}}for(var h=0;h<d.length;h++){delete a[d[h]]}try{a["_sort"]&&delete a["_sort"];a["_sord"]&&delete a["_sord"];a["_c"]&&delete a["_c"];a["_f"]&&delete a["_f"]}catch(i){}if(f.length){a["_c"]=f.join("|")}a["_tb"]=e.postData["_tb"];a=I(a);return a}function B(a,b){var c;if(p){if(!A){A=!0;jQuery.template("we7_tmpl",e.rowTemplate)}c=jQuery("<p>").append(jQuery.tmpl("we7_tmpl",this));return a===!0?c.text():c.html()}else{return!1}}function z(a){function b(a,b){var c=[];$.each(a,function(d,e){if(b.call(a,e,d)===!0){c.push(d)}});return c.length?c:null}var c,d=!!jQuery.fn.datepicker,f=we7(e.colModel)?we7(e.colModel).clone():[];if(!e.colModel){e.colModel=[]}$.each(a,function(a,d){c=b(f,function(a){return a.name===d.name});if(c&&c.length>0){$.each(c,function(a,b){var c=f[b];if(c.editable){d.editable=!0;if(c.edittype){d.edittype=c.edittype}else{d.edittype="text"}}if(d.sortable){d.sortable=!0;c.sorttype&&(d.sorttype=c.sorttype)}!!c.header&&(d.header=c.header);!!c.sortOnload&&(d.sortOnload=c.sortOnload);e.colModel[b]=d})}else{if(e.rowTemplate){d.hidden=!0}e.colModel.push(d)}});r=!!we7.findInArray(e.colModel,function(a){return a.editable&&!a.hidden});if(e.deletableRow||r){o=!0;e.editurl="/admin/ajax/BusinessSubmit/JsonForCondition.ashx";e.serializeRowData=C;e.serializeDelData=C;if(e.addEditColumn){e.colModel.push({header:e.editColumnHeader,name:"_action",sortable:!1,width:50})}if(r){e.ondblClickRow=D}}var g,h=we7.findInArray(e.colModel,function(a){return!!a.sortOnLoad});if(h){e.sortname=h.name;e.sortorder=h.sortOnLoad===!0?"desc":h.sortOnLoad}e.colNames=[];$.each(e.colModel,function(a,b){if(!e.we7Models){e.we7Models={}}g=b.name.substr(0,7)==="we7col_"?b.editKey:b.name;if(b.editable&&!we7.isUndef(e.we7Models[g])){b.editoptions=$.extend(b.editoptions||{},e.we7Models[g]);if(b.edittype==="date"){b.edittype="text";if(!d){we7.load([{name:"jqueryui",src:"/Scripts/jQuery/jQueryUI/jQuery-ui.js"},{name:"_jqueryui_css",src:"/Scripts/jQuery/jQueryUI/css/jQuery-ui.css"}]);d=!0}if(!b.editoptions){b.editoptions={}}var c=b.editoptions.dataInit;b.editoptions.dataInit=function(a){if(c){c.apply(this,Array.prototype.slice.apply(arguments))}var b=function(a){a.preventDefault();a.stopPropagation()};setTimeout(function(){$(a).datepicker();$(a).focus(function(){$(this).datepicker("show")}).keydown(b).bind("paste",b).bind("contextmenu",b)},50)}}}if(b.sortable&&we7.isUndef(b.index)){b.index=b.name}e.colNames.push(b.header||b.name||"");try{!we7.isUndef(b.header)&&delete b.header;!we7.isUndef(b.sortOnLoad)&&delete b.sortOnLoad;!we7.isUndef(b.identify)&&delete b.identify}catch(f){}e.colModel[a]=b});delete e.we7Models;if(x){$.each(x.split(","),function(a,b){var c=we7.indexOfArray(e.colModel,function(a){return this.name===b});if(c>-1){e.colModel[c].searchable=!0}});x=undefined}}function y(){if(!e.rowTemplate){return}var a=/\<td[^>]*\>(((?!\<\/?td).)+)\<\/td\>/gi,b=/^\$\{([a-z0-9_]+)\}$/i,c=/\$\{([a-z0-9_]+)\}/gi,d=[],f,g=[],h;while(f=a.exec(e.rowTemplate)){var i=$(f[0]),j,k,l,m=f[1],n,o;l=b.exec(m);j={header:jQuery.trim(i.attr("header")||""),sorttype:i.attr("sorttype")||"text",sortOnload:i.attr("sortOnload")||!1,width:i.attr("width")||parseInt(i.css("width"))||undefined};n=i.attr("editable");if(n){if(n!=="!1"){j.editable=!0;if(n!=="!0"){j.edittype=n}else{j.edittype="text"}}else{j.editable=!1}}else{j.editable=!1}if(l){j.name=l[1]}else{j.index=i.attr("sortkey")||undefined;j.name="we7col_"+Math.floor(Math.random()*1e3);k=i.attr("editkey");if(k){j.editKey=k}else{j.editable=!1}}if(!we7.isUndef(j.index)){j.sortable=!0}else{j.sortable=!1}d.push(j);while(h=c.exec(m)){g.push(h[1])}}if(d.length){e.colModel=d;x=g.join(",")}}function n(a,b){var c=$.Event();c.type=a;g.trigger(c,b);return c}e=e||{};var f=this,g=$(this),h=a.selector.substr(1),i="jqGridPager_"+h;var j=!!(e.colNames&&e.colModel),k,l=/^(http|\/admin).+/;if(we7.isStr(d)){if(l.test(d)){k=d;e.datatype="json"}else{e.datastr=d;e.datatype="jsonstring"}}else if(we7.isArr(d)){e.data=d;e.datatype="local";j=!0}else{e=$.extend(d||{},e)}if(!e.pager){$(we7.formatStr('<div id="{0}" class="we7-jqGrid-Pager" />',i)).insertAfter(a)}var m={altRows:!0,gridview:!0,height:"auto",hidegrid:!1,autoencode:!0,mtype:"POST",ignoreCase:!0,sortorder:"desc",viewrecords:!0,rowNum:20,rowList:[10,20,30,50],pager:"#"+i,pagerpos:"right",recordpos:"left",prmNames:{page:"_page",rows:"_rows",sort:"_sort",order:"_sord",nd:"_t",search:"_search",id:"_id",oper:"_oper",editoper:"3",deloper:"1",totalrows:"_tr",filter:"_condition"},serializeGridData:function(a){var b=a["_sord"];if(b){a["_sord"]=b.toLowerCase()==="desc"?1:0}delete a["_search"];return a},jsonReader:{id:"_gridID",repeatitems:!1,page:"currPage",total:"totalPages",records:"totalRecords"},addEditColumn:!0,editColumnHeader:"操作",deletableRow:!1};e=$.extend(m,e);if(!e.ajaxDelOptions){e.ajaxDelOptions={}}e.loadError=function(){n("onLoadError",[].slice.apply(arguments))};$.extend(this,{destroy:function(){var a=n("onBeforeDestroy");if(a.isDefaultPrevented()){return!1}$.jgrid.GridDestroy(h);n("onDestroy")},refresh:function(){var a={},b=n("onBeforeLoad",[a,!0]);if(b.isDefaultPrevented()){return!1}s.trigger("reloadGrid")}});$.each("onBeforeLoad,onBeforeDelete,onBeforeEdit,onBeforeDestroy,onLoad,onLoadError,onDelete,onEdit,onDestroy".split(","),function(a,b){f[b]=function(a){g.bind(b,a)};if(we7.isFunc(e[b])){g.bind(b,e[b])}});f.onLoadError(function(a,b,c){we7.log("#bxhr01\n"+(c?c.message?c.message:"[bind error] http status:"+c.toString():"unknow error:"+c.toString()+" ["+b+"]"))});var o=!1,p=!1,q=!1,r=!1,s,t,f=this,u,v,w,x;var A=!1;jQuery.jgrid._operateEditUI=function(a,b){var c=$("tr#"+a).find("td:last").find("span");if(b){if(!we7.isUndef(u)){jQuery.jgrid._operateEditUI(u,!1)}u=a;c.show();c.filter(":eq(0)").hide();if(e.deletableRow){c.filter(":eq(1)").hide()}}else{s.jqGrid("restoreRow",a);c.hide();c.filter(":eq(0)").show();if(e.deletableRow){c.filter(":eq(1)").show()}u=undefined}c=undefined};jQuery.jgrid._editRow=D;jQuery.jgrid._delRow=E;var G,H=function(a){var b="ID";if(b){if(a&&a.rows&&a.rows.length){$.each(a.rows,function(b,c){a.rows[b]._gridID=c.ID.replace("{","-_-").replace("}","_-_")})}}return a},I=function(a){a._id=a._id.replace("-_-","{").replace("_-_","}");return a},J=function(a){a.cols&&delete a.cols},K=function(a){function b(a){var b=$("<td>");$(t.rows.namedItem(c[a])).append(b);return b}if(!p&&!j){z(a.cols);if(e.rowTemplate){p=!0}}else if(s){if(o){var c=s.jqGrid("getDataIDs");for(var d=0;d<c.length;d++){var f="#"+h,g=c[d],i=0,k="",l='<span class="ui-icon ui-icon-pencil" title="编辑" style="cursor:pointer;float:left;" onclick="jQuery.jgrid._operateEditUI (\'{1}\',!0);jQuery.jgrid._editRow(\'{1}\');" ></span>',m='<span class="ui-icon ui-icon-trash" title="删除" style="cursor:pointer;float:left;" onclick="jQuery.jgrid._delRow(\'{1}\')" ></span>',n='<span class="ui-icon ui-icon-disk" title="保存" style="cursor:pointer;float:left;display:none" onclick="jQuery(\'{0}\').saveRow(\'{1}\');jQuery.jgrid._operateEditUI (\'{1}\',!1);" ></span>',q='<span class="ui-icon ui-icon-arrowreturnthick-1-w" title="取消编辑" style="cursor:pointer;float:left;display:none" onclick="jQuery.jgrid._operateEditUI (\'{1}\',!1);" ></span>';l=we7.formatStr(l,f,g);m=we7.formatStr(m,f,g);n=we7.formatStr(n,f,g);q=we7.formatStr(q,f,g);if(r){i+=40;k+=l}if(e.deletableRow){!r&&(i+=20);k+=m}if(r){k+=n+q}b(d).css("text-align","center").append($("<div>").css({margin:"5px auto",width:i+"px"}).html(k))}}if(!w){w=!0;var u=$("#gview_"+h).find("div.ui-jqgrid-titlebar:first");var v=$("<div>查找：</div>").addClass("jqgrid-we7search"),x=$('<input type="text" maxlength="30" style="border-style:inset" />').addClass("jqgrid-we7sinput"),y;u.append(v);x.keyup(function(){var a=this.value;y=setTimeout(function(){F(a)},680)}).keydown(function(){if(y){try{clearTimeout(y);y=undefined}catch(a){}}}).appendTo(v)}}},L=function(b){e.gridComplete=K;b&&K(b);e.loadComplete=J;b&&J(b);s=$(a).jqGrid(e);t=s[0];b&&t.addJSONData(b);v=b;f.grid=s};y();if(k){e.postData&&(e.postData["_rows"]=e.rowNum);G={url:k,type:"POST",dataType:"json",data:e.postData,success:function(a,b,c){if(!a||a&&a.code!=200){n("onLoadError",[c,b,a]);return}$.extend(e,{url:k,loadBeforeSend:function(a,b){var c=n("onBeforeLoad",[b]);if(c.isDefaultPrevented()){return!1}if(!j){j=!0;return!1}},beforeProcessing:function(a,b,c){var d=!1;if(!a||a.code&&a.code!=200){d=!0;n("onLoadError",[c,b,a])}else{a=H(a)}v=a},rowInjector:B});a=H(a);L(a,e)},error:function(a,b,c){n("onLoadError",[a,textStatus,c])}};var M=n("onBeforeLoad",[G]);if(M===!1){return!1}$.ajax(G);if(e.postData){delete e.postData._sort;delete e.postData._sord;delete e.postData._rows}}else{var M=n("onBeforeLoad");if(M===!1){return!1}L(d,e)}}jQuery.jgrid.no_legacy_api=!0;jQuery.jgrid.useJSON=!0;var b={contains:1,greaterThan:2,greaterOrEquals:3,lessThan:4,lessOrEqual:5,equals:6,notEqual:7,notContain:8,isNull:9,notNull:10,beginWith:11,endWidth:12,notBeginWidth:13,notEndWidth:14};c.parse=function(a){we7.log("method not implemented: we7.BindCondition.parse")};we7.BindOption=d;we7.BindCondition=c;we7.bindVerb=b;we7.bind=function(b,c,d){if(!we7.isObj(c)||we7.isUndef(c.tableName)){throw new Error("Unknow bind data")}var e="/admin/ajax/BusinessSubmit/JsonForCondition.ashx";!d.postData&&(d.postData={});$.extend(d.postData,c.toParam());if(we7.isObj(c.fields)){d.we7Models=c.fields}var f=$('<div type="text/we7tmpl" />').append(b.find("tr:first").children());var g=we7.browser.ff?unescape(f.html()):f.html();g=jQuery.trim(g.replace(/\<tbody\>\s*\<tr\>/,'').replace(/\<\/tr\>\s*\<\/tbody\>/,''));if(g){d.rowTemplate=g}if(c.sortField){d.sortname=d.sortname||c.sortField;d.sortorder=we7.isUndef(d.sortorder)?c.sortOrder:d.sortorder}f=undefined;b.empty();b.show();return new a(b,e,d)};we7.bindJSON=function(b,c,d){return new a(b,c,d)};window.we7.extend({bind:function(a,b){return we7.bind(this.jquery,a,b)},bindJSON:function(a,b){return we7.bindJSON(this.jquery,a,b)}})})()